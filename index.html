<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>H·ªá th·ªëng Qu·∫£n l√Ω V·∫≠t t∆∞</title>
    <meta http-equiv="refresh" content="300">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
        }
        .container {
            background: white;
            color: #333;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 500px;
            margin: 0 auto;
        }
        .loading {
            font-size: 18px;
            margin: 20px 0;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #status {
            margin: 20px 0;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
            color: #1976d2;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ ƒêang k·∫øt n·ªëi h·ªá th·ªëng...</h1>
        <div class="spinner"></div>
        <p class="loading">Vui l√≤ng ƒë·ª£i</p>
        <div id="status">ƒêang ki·ªÉm tra k·∫øt n·ªëi...</div>
    </div>
    
    <script>
        // API endpoint ƒë·ªÉ l·∫•y tunnel URL m·ªõi nh·∫•t
        const API_URL = 'https://raw.githubusercontent.com/monsterph9-ops/qlvtttb-redirect/main/current_url.txt';
        const STORAGE_KEY = 'qlvtttb_current_url';
        const CHECK_INTERVAL = 5000; // Ki·ªÉm tra m·ªói 5 gi√¢y
        
        let currentUrl = localStorage.getItem(STORAGE_KEY);
        let checkTimer = null;
        
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        function redirectToApp(url) {
            // L∆∞u URL hi·ªán t·∫°i v√†o localStorage
            localStorage.setItem(STORAGE_KEY, url);
            
            // Chuy·ªÉn h∆∞·ªõng ngay
            updateStatus('ƒêang chuy·ªÉn h∆∞·ªõng...');
            window.location.replace(url.trim());
        }
        
        function checkAndRedirect() {
            fetch(API_URL + '?t=' + Date.now(), {cache: 'no-store'})
                .then(response => response.text())
                .then(newUrl => {
                    newUrl = newUrl.trim();
                    
                    if (!newUrl || !newUrl.startsWith('http')) {
                        updateStatus('L·ªói: URL kh√¥ng h·ª£p l·ªá');
                        return;
                    }
                    
                    // N·∫øu ch∆∞a c√≥ URL ho·∫∑c URL thay ƒë·ªïi
                    if (!currentUrl || currentUrl !== newUrl) {
                        updateStatus('Ph√°t hi·ªán server m·ªõi, ƒëang k·∫øt n·ªëi...');
                        redirectToApp(newUrl);
                    } else {
                        // URL gi·ªëng nhau, redirect lu√¥n
                        redirectToApp(newUrl);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    updateStatus('L·ªói k·∫øt n·ªëi, ƒëang th·ª≠ l·∫°i...');
                    
                    // N·∫øu c√≥ URL c≈© trong cache, th·ª≠ d√πng
                    if (currentUrl) {
                        setTimeout(() => {
                            redirectToApp(currentUrl);
                        }, 2000);
                    }
                });
        }
        
        // Ki·ªÉm tra v√† redirect ngay khi load trang
        checkAndRedirect();
    </script>
</body>
</html>
